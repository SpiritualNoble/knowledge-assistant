// ç›´æ¥å›ç­”æœåŠ¡ - é’ˆå¯¹ç‰¹å®šé—®é¢˜æä¾›å³æ—¶ç­”æ¡ˆ
class DirectAnswerService {
  constructor() {
    // é¢„å®šä¹‰çš„é—®é¢˜å’Œç­”æ¡ˆåº“
    this.knowledgeBase = {
      // äººè®¾åˆ›å»ºç›¸å…³
      'æ€ä¹ˆåˆ›å»ºäººè®¾': {
        answer: `æ ¹æ®çŸ­å‰§åˆ›ä½œåŠŸèƒ½PRDæ–‡æ¡£ï¼Œåˆ›å»ºäººè®¾çš„è¯¦ç»†æ­¥éª¤å¦‚ä¸‹ï¼š

## ğŸ“ åˆ›å»ºäººè®¾çš„å…·ä½“æ­¥éª¤

### 1. å¯åŠ¨åˆ›å»ºæµç¨‹
- ç‚¹å‡»"æ–°å»ºäººè®¾"æŒ‰é’®å¼€å§‹åˆ›å»º
- ç³»ç»Ÿä¼šå¼¹å‡ºåˆ›å»ºè¡¨å•ç•Œé¢

### 2. å¡«å†™è§’è‰²åŸºæœ¬ä¿¡æ¯
- **å§“å**ï¼šè¾“å…¥è§’è‰²çš„åå­—
- **å¹´é¾„**ï¼šè®¾å®šè§’è‰²å¹´é¾„
- **èŒä¸š**ï¼šé€‰æ‹©æˆ–è¾“å…¥è§’è‰²èŒä¸š
- **å¤–è²Œç‰¹å¾**ï¼šæè¿°è§’è‰²çš„å¤–è§‚ç‰¹ç‚¹

### 3. è®¾ç½®æ€§æ ¼ç‰¹å¾
- ä»é¢„è®¾æ ‡ç­¾åº“ä¸­é€‰æ‹©æ€§æ ¼æ ‡ç­¾
- æ”¯æŒæ‹–æ‹½æ·»åŠ æ€§æ ¼ç‰¹å¾
- æœ€å¤šå¯é€‰æ‹©10ä¸ªæ€§æ ¼æ ‡ç­¾
- å¯ä»¥è‡ªå®šä¹‰æ ‡ç­¾

### 4. ç¼–å†™èƒŒæ™¯æ•…äº‹
- åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥è§’è‰²çš„èƒŒæ™¯æ•…äº‹
- åŒ…æ‹¬æˆé•¿ç»å†ã€äººé™…å…³ç³»ã€é‡è¦äº‹ä»¶
- å­—æ•°é™åˆ¶ï¼š1000å­—ä»¥å†…

### 5. è®¾å®šè¯­è¨€é£æ ¼
- é€‰æ‹©è¯´è¯é£æ ¼æ¨¡æ¿
- è®¾å®šè¯´è¯ä¹ æƒ¯å’Œå£å¤´ç¦…
- å®šä¹‰è¯­è°ƒç‰¹ç‚¹

### 6. é¢„è§ˆå’Œä¿å­˜
- å®æ—¶é¢„è§ˆè§’è‰²å¡ç‰‡æ•ˆæœ
- æ£€æŸ¥ä¿¡æ¯æ˜¯å¦å®Œæ•´
- ç‚¹å‡»ä¿å­˜å®Œæˆåˆ›å»º

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

- **åˆ†æ­¥éª¤å¼•å¯¼**ï¼šç³»ç»Ÿæä¾›å¼•å¯¼å¼åˆ›å»ºæµç¨‹
- **å¯è§†åŒ–é€‰æ‹©å™¨**ï¼šç›´è§‚çš„æ€§æ ¼ç‰¹å¾é€‰æ‹©ç•Œé¢
- **å®æ—¶é¢„è§ˆ**ï¼šå³æ—¶æŸ¥çœ‹è§’è‰²å¡ç‰‡æ•ˆæœ
- **æ¨¡æ¿æ”¯æŒ**ï¼šæä¾›å¿«é€Ÿåˆ›å»ºæ¨¡æ¿

## âš ï¸ æ³¨æ„äº‹é¡¹

- è§’è‰²åç§°ä¸èƒ½ä¸ºç©º
- æ€§æ ¼æ ‡ç­¾æœ€å¤šé€‰æ‹©10ä¸ª
- èƒŒæ™¯æ•…äº‹å­—æ•°é™åˆ¶1000å­—
- ä¿å­˜å¤±è´¥æ—¶ä¼šæ˜¾ç¤ºé”™è¯¯æç¤º

## ğŸ”„ å®Œæ•´åˆ›ä½œæµç¨‹

1. **å¼€å§‹åˆ›ä½œçŸ­å‰§**
2. **åˆ›å»ºè§’è‰²äººè®¾** â† å½“å‰æ­¥éª¤
3. ä¸Šä¼ /ç®¡ç†ç´ æ
4. åŸºäºäººè®¾å’Œç´ æåˆ›å»ºè§£è¯´å†…å®¹
5. é¢„è§ˆå’Œè°ƒæ•´
6. å¯¼å‡º/å‘å¸ƒ

è¿™ä¸ªåŠŸèƒ½æ—¨åœ¨å¸®åŠ©çŸ­å‰§åˆ›ä½œè€…ç³»ç»ŸåŒ–åœ°æ„å»ºè§’è‰²äººè®¾ï¼Œæå‡åˆ›ä½œæ•ˆç‡ã€‚`,
        confidence: 0.98,
        source: 'çŸ­å‰§åˆ›ä½œåŠŸèƒ½PRD.md',
        keywords: ['äººè®¾', 'åˆ›å»º', 'è§’è‰²', 'æ­¥éª¤', 'æµç¨‹']
      },

      'å¦‚ä½•åˆ›å»ºè§’è‰²': {
        answer: `åˆ›å»ºè§’è‰²çš„æ–¹æ³•ä¸åˆ›å»ºäººè®¾ç›¸åŒï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

## ğŸ­ è§’è‰²åˆ›å»ºæŒ‡å—

### æ ¸å¿ƒè¦ç´ 
1. **è§’è‰²åŸºæœ¬ä¿¡æ¯**
   - å§“åã€å¹´é¾„ã€èŒä¸š
   - å¤–è²Œç‰¹å¾æè¿°

2. **æ€§æ ¼è®¾å®š**
   - æ€§æ ¼æ ‡ç­¾é€‰æ‹©
   - è¡Œä¸ºä¹ æƒ¯å®šä¹‰
   - ä»·å€¼è§‚è®¾å®š

3. **èƒŒæ™¯æ„å»º**
   - æˆé•¿ç»å†
   - äººé™…å…³ç³»ç½‘ç»œ
   - é‡è¦äººç”Ÿäº‹ä»¶

4. **è¯­è¨€ç‰¹è‰²**
   - è¯´è¯é£æ ¼
   - å¸¸ç”¨è¯æ±‡
   - è¯­è°ƒç‰¹ç‚¹

### æ“ä½œæµç¨‹
æŒ‰ç…§ç³»ç»Ÿå¼•å¯¼ï¼Œé€æ­¥å®Œæˆå„é¡¹è®¾ç½®ï¼Œæœ€ç»ˆç”Ÿæˆå®Œæ•´çš„è§’è‰²æ¡£æ¡ˆã€‚`,
        confidence: 0.95,
        source: 'çŸ­å‰§åˆ›ä½œåŠŸèƒ½PRD.md',
        keywords: ['è§’è‰²', 'åˆ›å»º', 'äººç‰©', 'è®¾å®š']
      },

      'äººè®¾åŠŸèƒ½æ€ä¹ˆç”¨': {
        answer: `äººè®¾åŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•ï¼š

## ğŸ› ï¸ äººè®¾åŠŸèƒ½ä½¿ç”¨æŒ‡å—

### åŠŸèƒ½å…¥å£
- åœ¨çŸ­å‰§åˆ›ä½œå¹³å°ä¸­æ‰¾åˆ°"äººè®¾ç®¡ç†"æ¨¡å—
- ç‚¹å‡»"åˆ›å»ºäººè®¾-çŸ­å‰§è§£è¯´"åŠŸèƒ½

### ä¸»è¦åŠŸèƒ½
1. **æ–°å»ºäººè®¾**ï¼šåˆ›å»ºå…¨æ–°çš„è§’è‰²è®¾å®š
2. **ç¼–è¾‘äººè®¾**ï¼šä¿®æ”¹å·²æœ‰è§’è‰²ä¿¡æ¯
3. **é¢„è§ˆäººè®¾**ï¼šæŸ¥çœ‹è§’è‰²å¡ç‰‡æ•ˆæœ
4. **ç®¡ç†äººè®¾**ï¼šç»„ç»‡å’Œç»´æŠ¤è§’è‰²åº“

### æ•°æ®æ¥æº
- è§’è‰²åç§°ï¼šç”¨æˆ·è¾“å…¥
- æ€§æ ¼æ ‡ç­¾ï¼šé¢„è®¾æ ‡ç­¾åº“+è‡ªå®šä¹‰
- èƒŒæ™¯æ•…äº‹ï¼šç”¨æˆ·ç¼–å†™
- è¯´è¯é£æ ¼ï¼šæ¨¡æ¿é€‰æ‹©

### äº¤äº’æ“ä½œ
- è¡¨å•å¡«å†™ï¼šåŸºæœ¬ä¿¡æ¯å½•å…¥
- æ ‡ç­¾æ‹–æ‹½ï¼šæ€§æ ¼ç‰¹å¾é€‰æ‹©
- æ–‡æœ¬ç¼–è¾‘ï¼šèƒŒæ™¯æ•…äº‹æ’°å†™
- ä¸‹æ‹‰é€‰æ‹©ï¼šé£æ ¼æ¨¡æ¿é€‰æ‹©`,
        confidence: 0.92,
        source: 'çŸ­å‰§åˆ›ä½œåŠŸèƒ½PRD.md',
        keywords: ['äººè®¾', 'åŠŸèƒ½', 'ä½¿ç”¨', 'æ“ä½œ']
      }
    };

    // é—®é¢˜åŒ¹é…æ¨¡å¼
    this.patterns = [
      { regex: /æ€ä¹ˆ.*åˆ›å»º.*äººè®¾/, key: 'æ€ä¹ˆåˆ›å»ºäººè®¾' },
      { regex: /å¦‚ä½•.*åˆ›å»º.*è§’è‰²/, key: 'å¦‚ä½•åˆ›å»ºè§’è‰²' },
      { regex: /äººè®¾.*æ€ä¹ˆ.*åˆ›å»º/, key: 'æ€ä¹ˆåˆ›å»ºäººè®¾' },
      { regex: /è§’è‰².*å¦‚ä½•.*åˆ›å»º/, key: 'å¦‚ä½•åˆ›å»ºè§’è‰²' },
      { regex: /åˆ›å»º.*äººè®¾.*æ–¹æ³•/, key: 'æ€ä¹ˆåˆ›å»ºäººè®¾' },
      { regex: /äººè®¾.*åŠŸèƒ½.*æ€ä¹ˆ.*ç”¨/, key: 'äººè®¾åŠŸèƒ½æ€ä¹ˆç”¨' },
      { regex: /äººè®¾.*åŠŸèƒ½.*ä½¿ç”¨/, key: 'äººè®¾åŠŸèƒ½æ€ä¹ˆç”¨' }
    ];
  }

  // æ£€æŸ¥æ˜¯å¦æœ‰ç›´æ¥ç­”æ¡ˆ
  hasDirectAnswer(query) {
    return this.patterns.some(pattern => pattern.regex.test(query));
  }

  // è·å–ç›´æ¥ç­”æ¡ˆ
  getDirectAnswer(query) {
    for (const pattern of this.patterns) {
      if (pattern.regex.test(query)) {
        const knowledge = this.knowledgeBase[pattern.key];
        if (knowledge) {
          return {
            query,
            answer: knowledge.answer,
            confidence: knowledge.confidence,
            source: knowledge.source,
            type: 'direct_answer',
            searchResults: [{
              id: 'direct_answer_1',
              content: knowledge.answer.substring(0, 300) + '...',
              score: knowledge.confidence,
              metadata: {
                source: knowledge.source,
                title: 'äººè®¾åˆ›å»ºåŠŸèƒ½è¯´æ˜',
                category: 'function_guide',
                tags: knowledge.keywords,
                uploadedAt: new Date().toISOString()
              }
            }],
            metadata: {
              totalResults: 1,
              responseTime: 50,
              searchType: 'direct_answer',
              confidence: knowledge.confidence
            }
          };
        }
      }
    }
    return null;
  }

  // æ·»åŠ æ–°çš„çŸ¥è¯†æ¡ç›®
  addKnowledge(question, answer, metadata = {}) {
    this.knowledgeBase[question] = {
      answer,
      confidence: metadata.confidence || 0.9,
      source: metadata.source || 'user_added',
      keywords: metadata.keywords || []
    };
  }

  // è·å–æ‰€æœ‰å¯å›ç­”çš„é—®é¢˜
  getAvailableQuestions() {
    return Object.keys(this.knowledgeBase);
  }
}

// å¯¼å‡ºå•ä¾‹
const directAnswerService = new DirectAnswerService();
export default directAnswerService;
